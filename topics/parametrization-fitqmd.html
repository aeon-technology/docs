<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DFF</title>
    <style>*,*:before,*:after{box-sizing:border-box}body{margin:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol;color:#333}nav a:where(.active){background:#333;color:#fff}img{display:block;max-width:100%}code{font-weight:600}pre{background:#444;color:#fff;padding:1ch}pre code{background-color:inherit}table{border-collapse:collapse}table :where(th,td){border:1px solid #666}:where(h2,h3,h4) a{color:inherit;text-decoration:none}:where(h2,h3,h4) a:hover{text-decoration:underline}:where(h2,h3,h4) a:hover:after{content:" #"}.c-app-layout{display:grid;margin:0 auto;grid-template-columns:auto 1fr;gap:32px}.c-app-menu{top:0;position:sticky;overflow-y:scroll;padding:0 32px;background-color:#eee;height:100vh}
</style>
  </head>
  <body class="c-app-layout">
    <aside class="c-app-menu">
      <nav class="u-reset"><p>I. Introduction</p>
<ul>
<li><a href="../index.html">Overview</a></li>
<li><a href="../features.html">Feature List</a></li>
<li><a href="../usecases.html">Typical Use Cases</a></li>
</ul>
<p>II. How To</p>
<ul>
<li><a href="../HowTo/Install.html">Download and installation</a></li>
<li><a href="../HowTo/License.html">Get license</a></li>
<li><a href="../HowTo/Navigate.html">Navigate DFF</a></li>
<li><a href="../HowTo/BuildModel.html">Build a model</a></li>
<li>Import models</li>
<li>Assign TEAMFF</li>
<li>Export models</li>
<li>Build a training set</li>
<li>Get quantum mechanics data</li>
<li>Fit quantum mechanics data</li>
<li>Fit Liquid data</li>
<li>Test force fields</li>
<li>Export to simulation software</li>
<li>Expand TEAMFF</li>
<li>Check out parameters from TEAMFF</li>
<li>Make new force field in TEAMFF</li>
<li>Make specific force field</li>
<li>Use Parametrization Workflow</li>
</ul>
<p>III. Tutorials</p>
<ul>
<li>[Overview] (./offline/tutorials.md)</li>
<li><a href="../offline/tutorials-project/lecture.html">Project and Models</a></li>
<li><a href="../offline/tutorials-liquid.html">Use TEAMFF for Liquids</a></li>
<li><a href="../offline/tutorials-polymer.html">Use TEAMFF for Macromolecules</a></li>
<li><a href="../offline/tutorials-mixforcefields.html">Use Multiple Force Fields of TEAMFF</a></li>
<li><a href="../offline/tutorialsB-qmdata.html">Prepare QM Data for Parameterization</a></li>
<li><a href="../offline/tutorialsB-fitmolecule.html">Fit QM Data of Molecules</a></li>
<li><a href="../offline/tutorialsB-fitliquid.html">Optimize LJ parameters</a></li>
<li><a href="../offline/tutorials-addteamff.html">Extend TEAMFF by Adding New Force Fields</a></li>
<li><a href="../offline/tutorials-useqmdff.html">Use QMDFF for Specific Force Fields</a></li>
</ul>
<p>IV References of Commands</p>
<ul>
<li><a href="../WinCommands/ProjectNav.html">Project Navigator</a></li>
<li><a href="../WinCommands/Toolbar.html">Toolbar</a></li>
<li><a href="../WinCommands/Mouse.html">Mouse Functions</a></li>
<li><a href="../WinCommands/File.html">File Menu</a></li>
<li><a href="../WinCommands/Edit.html">Edit Menu</a></li>
<li><a href="../WinCommands/Build.html">Build Menu</a></li>
<li><a href="../WinCommands/View.html">View Menu</a></li>
<li><a href="../WinCommands/TEAMFF.html">TEAMFF Menu</a></li>
<li><a href="../WinCommands/Simulation.html">Simulation Menu</a></li>
<li><a href="../WinCommands/QMDFF.html">QMDFF Menu</a></li>
<li><a href="../WinCommands/Forcefield.html">ForceField Menu</a></li>
<li><a href="../WinCommands/Parameter.html">Parameter Menu</a></li>
<li><a href="../WinCommands/QMD.html">QMD Menu</a></li>
<li><a href="../WinCommands/Help.html">Help Menu</a></li>
</ul>
<p>V. References of Executable Commands</p>
<ul>
<li><a href="../exe-commands/model-com.html">Model Commands</a></li>
<li><a href="../exe-commands/forcefield-com.html">ForceField Commands</a></li>
<li><a href="../exe-commands/export-com.html">Export Commands</a></li>
<li><a href="../exe-commands/database-com.html">TEAMFF Commands</a></li>
<li><a href="../exe-commands/fit-com.html">Fit Commands</a></li>
<li><a href="../exe-commands/mm-com.html">Molecular Mechanics Commands</a></li>
<li><a href="../exe-commands/qm-com.html">Quantum Mechanics Commands</a></li>
<li><a href="../exe-commands/qmdff-com.html">QMDFF commands</a></li>
</ul>
<p>IV. Concepts, Methods and Algorithms</p>
<ul>
<li>
<p><a href="introduction.html">Introduction</a></p>
</li>
<li>
<p><a href="forcefield-types.html">Force Field Types</a></p>
<ul>
<li><a href="forcefield-types.html">AMBER Type</a></li>
<li><a href="forcefield-types.html">TEAM Type</a></li>
</ul>
</li>
<li>
<p><a href="atom-types.html">Atom Types</a></p>
<ul>
<li><a href="atom-types-properties.html">Molecular and Atomic Properties</a></li>
<li><a href="atom-types-typingrules.html">Typing Rules</a></li>
<li><a href="atom-types-extensible.html">Extensible Definitions</a></li>
<li><a href="atom-types-hypervalence.html">Hyper-valence</a></li>
<li><a href="atom-types-equivalence.html">Equivalent Types</a></li>
<li><a href="atom-types-integrated.html">Integrated Types</a></li>
</ul>
</li>
<li>
<p><a href="parametrization.html">Parametrization</a></p>
<ul>
<li><a href="parametrization-trainingset.html">Training Set</a></li>
<li><a href="parametrization-general.html">General Procedure</a></li>
<li><a href="parametrization-autoPar.html">Automatic Parameters</a></li>
<li><a href="parametrization-qmd.html">Quantum Mechanics Data </a></li>
<li><a href="parametrization-fitqmd.html">Fit Quantum Mechanics Data </a></li>
<li><a href="parametrization-fitdimer.html">Fit Molecular Dimer</a></li>
<li><a href="parametrization-fitliquid.html">Fit Liquid Data</a></li>
</ul>
</li>
<li>
<p><a href="teamff-database.html">TEAMFF Database</a></p>
<ul>
<li><a href="teamff-forcefields.html">Included Force Fields</a></li>
<li><a href="teamff-extensibility.html">Extensibility of TEAMFF</a></li>
</ul>
</li>
<li>
<p><a href="qmdff-database.html">QMDFF Database</a></p>
</li>
<li>
<p><a href="molecular-simulations.html">Molecular Simulations</a></p>
</li>
</ul>
<p>WebDFF</p>
<ul>
<li><a href="../online/registration.html">Registration</a></li>
<li><a href="../online/tutorial.html">Tutorial</a></li>
<li><a href="../online/support.html">Support</a></li>
</ul>
<p>Appendix</p>
<ul>
<li><a href="../appendix/functions.html">Force Field Functions</a></li>
<li><a href="../exe-commands/firl-formats.html">File Formats</a></li>
</ul>
<p>Temporary Examples</p>
<ul>
<li><a href="../ch00/01-basic-syntax.html">Basic syntax</a></li>
<li><a href="../ch00/02-footnote.html">Footnote</a></li>
<li><a href="../ch00/03-table.html">Table</a></li>
<li><a href="../ch00/04-math-expression.html">Math expression</a></li>
</ul></nav>
    </aside>
    <main id="main"><article><p>Fit Quantum Mechanics Data</p>
<p>Methods
Atomic charges must be calculated and assigned first. Atomic charges can be calculated using QM methods (ESP charges or Mulliken Charges) or using the charge equilibrium method. Direct Forcefield uses a charge equilibrium method similar to the published QEq method. The basic parameters used to calculate charge distribution are the ionization potentials (IP) and electron affinities (EA) of relevant atoms, which are collected from literature and included in the Elements.dat file.
Charge parameters are derived from QM atomic charges by solving a set of linear equations. Suppose a set of atomic charges are given in a vector Q for M atoms:
Q=[q_1,q_2,...q_M ]<em>M.								(1)
The charge parameters can then be calculated by:
AP=Q,							 		(2)
where P is the charge parameter vector in N order:
P=[q_1^o,q_2^o,q_3^o,...δ_12,δ_13...]<em>N					(3)
and A is an assignment matrix:
A=[a</em>(i,j) ]<em>MxN								(4)
for each atom i and nearest neighbor j:
a</em>(i,i)=1,■(&#x26;)a</em>(i,j)=1,■(&#x26;)a_(j,i)=-1,				(5)
and where all of the other elements are zero. Assignment matrix elements are determined using ATC and BIC parameters as expressed in Eq. (1).
In general, the number of atoms (M) is greater than the number of charge parameters (N). Therefore, Eq. (3) does not have a precise solution. The singular value decomposition (SVD) method49 is used to find the best solution as determined by the least-squares approach.
Nonlinear Terms</p>
<p>The Levenberg-Marquardt method49 with constrained minimization technique is used to fit QMD in order to derive valence terms. At this stage, charge and VDW parameters are frozen, as charge parameters should have already been derived from QMD, while VDW parameters are initialized using a set of default parameters provided by DFF.</p>
<p>The least squares problem is written as:
χ^2=∑_(i=1)^N▒[(y_i-y_i (a ⃗))/σ_i ] ^2+∑_j^Na▒〖P_j (a_j-a_j^o ) 〗^2					(6)
The first term is the normal least squares expression of input data and parameter-dependent calculated data. The weighting factor σi differs for different data and can be related to the Boltzmann factor for energy data.  The second term is a penalty term in which parameters are restrained to preferred values. The penalty factor Pj is an adjustable factor that controls the constraints. The above equation is reduced to the normal least-squares equation by setting all penalty factors to zero.</p>
<p>Linear Terms</p>
<p>In addition, the SVD method49 is used to reduce redundant problems for linear terms. By limiting variables to linear terms only, the least-squares equation is reduced to a linear equation:
χ^2=∑_(i=1)^N▒[(y_i-∑_(k=1)^M▒〖a_k X_k 〗)/σ_i ] ^2=|A⋅a-B|						(7)
If some parameters are linear combinations of others, matrix A is singular or numerically very close to singular, and the SVD method is suitable for solving this problem.
Charge Parameters
A common way to derive charge parameters from QM data is to convert QM atomic partial charges to charge parameters. Atomic partial charges are calculated from QM wave functions. ESP charges are obtained by fitting to electrostatic potentials, and are thus dependent on how the fit was conducted. ESP charges for atoms in a bulky molecule are typically difficult to obtain as they may be insufficiently sampled. On the other hand, atomic partial charges determined using population analyses such as the Mulliken method are stable. Both types of atomic partial charges have been used in forcefield development.
There are three types of charge parameters: atom based, atom-type based and bond-type based. Atom based charge parameters are identified by atom names (usually element symbol plus sequence number) assigned by the program. Atom-type based parameters are defined by atom types.  Each atom type has a charge parameter, and all atoms that have the same atom type share one parameter. The bond-type based parameter is also called bond charge increment, which is specified by atom types of two bonded atoms (δt(i),at(j)). This parameter represents charge relocation from atom j to atom i. For example, if δat(i),at(j) = 0.5, that means atom i gains 0.5 electron, and atom j loses 0.5 electron. For any atom i, the net charge is a sum of all relevant bond charge increments.
q_i=q_i^o+∑_j▒δ_ij  								(8)
Atom based charge parameters are difficult to transfer; bond-type based charge parameters reflect the interactions of nearest neighbors and ensure charge neutrality of the entire molecule; and atom-type based charges provides the flexibility to assign net charges. DFF uses atom-type and bond-type based charge parameters in developed forcefields. This scheme is flexible to represent any molecules, ionic or non-ionic.
Valence Parameters</p>
<p>Valence parameters are the largest component of a forcefield, making up a majority of all parameters. For a forcefield with N atom types, the number of valence parameters are on the order of O(N2), O(N3) and O(N4) for bond, angle and dihedral angle terms respectively. Although using equivalence tables can reduce the number of atom types and parameters effectively, the number of valence parameters remains very large.</p>
<p>Therefore, optimization of these parameters to fit QM data is a high-dimension optimization problem. In principle, optimization can be achieved using the least-square approach, but in practice it is usually a very difficult task. The fit can be both over-determined (more parameters than data) for some properties and under-determined (more data than parameters) for others.  In addition, the correlations and dependencies among parameters make the problem worse.</p>
<p>DFF has been designed to solve these problems using various techniques. An expert system that examines the data, decides an appropriate fitting procedure, monitors the fitting process and adjusts fitting options has been implemented to guide the automated parameterization process.</p>
<p>It may be necessary to adjust the fitting options or initial parameters in order to get a better fit for very complicated systems. Adding controls to the initial parameters is usually very helpful, especially when data is limited. For example, freezing some parameters to reduce the number of adjustable parameters is usually an effective approach to improving fit quality.</p></article></main>
    <script type="module">"use strict";console.log("ui ready");[...document.querySelectorAll("nav a")].find(a=>a.pathname===location.pathname)?.classList.add("active");
</script>
  </body>
</html>
